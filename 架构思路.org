#+TITLE: 架构思路
* 设计哲学
设计哲学：
一切皆为扁平Block，弱化层级、文档、文件树。

** 输入层
负责输入、解析文档的层，可支持多个不同的输入格式，默认输入格式是org格式，输入层的功能是将文档解析为S表达式的块数据格式存储。
输入层输入的是一个代表特定视图的文档文件，将该文档和视图解析并存储到存储层的数据格式，但不是所有文档视图都是可输入的。

** 构造层
构造层是作为构造文档的中间层，构造层负责接收输入层的输入，并转换为内部AST树结构。
*** 块
块是文档最小的构成单元，作为语义的原子。

格式可类似下面这样：
#+begin_src scheme
  (block
   (id 123)
   (descrption "这段讲的是关于知识锁的信息。")
   (source "知识锁的本质是信息差…")
   (type text)
   (tags '("game" "design"))
   (created "2025-11-24")
   (modified "2025-11-24"))
#+end_src

#+begin_src scheme
  (block
   (id 456)
   (descrption "一张关于知识锁的图片。")
   (source "/path/to/picture")
   (type text)
   (tags '("game" "design"))
   (created "2025-11-24")
   (modified "2025-11-24"))
#+end_src

*** 视图（用GOOPS实现）
视图是展示块的规则和容器，视图本身具备可嵌套性和可自指性（可以引用自己）。
每个视图对象，都只展示一组固定的视图或块。
每个视图类型，则是代表这个视图的规则本身。

** 存储层
底层真实的文件数据，全部用S表达式的格式交给存储后端（视情况编码解码）并存储（默认是文件系统，后期可扩展数据库），支持多存储后端并行存储。

** 输出层
输出层输出的是一个视图，通常会根据输出后端来决定将视图输出到文档还是显示端。

